#include <stdio.h>
#include "debug.h"

void debug_instruction(struct cpu *cpu) {
	static const char *format_table[0x100] = {
	/* IMP */ "%s\n",
	/* ACC */ "%s A\n",
	/* IMM */ "%s %0d#%02X\n",
	/* ZPA */ "%s $%02X\n",
	/* ZPX */ "%s $%02X,X\n",
	/* ZPY */ "%s $%02X,Y\n",
	/* REL */ "%s *%+d\n",
	/* ABO */ "%s $%04X\n",
	/* ABX */ "%s $%04X,X\n",
	/* ABY */ "%s $%04X,Y\n",
	/* IMP */ "%s ($%04X)\n",
	/* IIX */ "%s ($%02X,X)\n",
	/* IIY */ "%s ($%02X),Y\n"
	};

	static const char *name_table[0x100] = {
	/*         0x00   0x01   0x02   0x03   0x04   0x05   0x06   0x07   0x08   0x09   0x0A   0x0B   0x0C   0x0D   0x0E   0x0F */
	/* 0x00 */ "BRK", "ORA", "???", "???", "???", "ORA", "ASL", "???", "PHP", "ORA", "ASL", "???", "???", "ORA", "ASL", "???",
	/* 0x10 */ "BPL", "ORA", "???", "???", "???", "ORA", "ASL", "???", "CLC", "ORA", "???", "???", "???", "ORA", "ASL", "???",
	/* 0x20 */ "JSR", "AND", "???", "???", "BIT", "AND", "ROL", "???", "PLP", "AND", "ROL", "???", "BIT", "AND", "ROL", "???",
	/* 0x30 */ "BMI", "AND", "???", "???", "???", "AND", "ROL", "???", "SEC", "AND", "???", "???", "???", "AND", "ROL", "???",
	/* 0x40 */ "RTI", "EOR", "???", "???", "???", "EOR", "LSR", "???", "PHA", "EOR", "LSR", "???", "JMP", "EOR", "LSR", "???",
	/* 0x50 */ "BVC", "EOR", "???", "???", "???", "EOR", "LSR", "???", "CLI", "EOR", "???", "???", "???", "EOR", "LSR", "???",
	/* 0x60 */ "RTS", "ADC", "???", "???", "???", "ADC", "ROR", "???", "PLA", "ADC", "ROR", "???", "JMP", "ADC", "ROR", "???",
	/* 0x70 */ "BVS", "ADC", "???", "???", "???", "ADC", "ROR", "???", "SEI", "ADC", "???", "???", "???", "ADC", "ROR", "???",
	/* 0x80 */ "???", "STA", "???", "???", "STY", "STA", "STX", "???", "DEY", "???", "TXA", "???", "STY", "STA", "STX", "???",
	/* 0x90 */ "BCC", "STA", "???", "???", "STY", "STA", "STX", "???", "TYA", "STA", "TXS", "???", "???", "STA", "???", "???",
	/* 0xA0 */ "LDY", "LDA", "LDX", "???", "LDY", "LDA", "LDX", "???", "TAY", "LDA", "TAX", "???", "LDY", "LDA", "LDX", "???",
	/* 0xB0 */ "BCS", "LDA", "???", "???", "LDY", "LDA", "LDX", "???", "CLV", "LDA", "TSX", "???", "LDY", "LDA", "LDX", "???",
	/* 0xC0 */ "CPY", "CMP", "???", "???", "CPY", "CMP", "DEC", "???", "INY", "CMP", "DEX", "???", "CPY", "CMP", "DEC", "???",
	/* 0xD0 */ "BNE", "CMP", "???", "???", "???", "CMP", "DEC", "???", "CLD", "CMP", "???", "???", "???", "CMP", "DEC", "???",
	/* 0xE0 */ "CPX", "SBC", "???", "???", "CPX", "SBC", "INC", "???", "INX", "SBC", "NOP", "???", "CPX", "SBC", "INC", "???",
	/* 0xF0 */ "BEQ", "SBC", "???", "???", "???", "SBC", "INC", "???", "SED", "SBC", "???", "???", "???", "SBC", "INC", "???"
	};

	printf(format_table[cpu->addressing_mode], name_table[cpu->instruction], cpu->operand_address, cpu->operand);
}

void debug_status(struct cpu *cpu) {
	printf(
		"PC   SP AC X  Y  C Z I D B O N\n"
		"%04X %02X %02X %02X %02X %d %d %d %d %d %d %d\n",
		cpu->program_counter, cpu->stack_pointer, cpu->accumulator, cpu->x, cpu->y,
		cpu->carry, cpu->zero, cpu->interrupt_disable, cpu->decimal_mode,
		cpu->break_command, cpu->overflow, cpu->negative
	);
}